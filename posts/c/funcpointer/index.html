<!DOCTYPE html>
<html><head><title>함수 포인터를 써보자</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="../../../main.css" type="text/css"></head><body><header><a id="title" href="../../.."><h1>scarf@127.0.0.1</h1></a><nav><ul><li><a href="../../../about">About</a></li><li><a href="../..">Posts</a></li><li><a href="../../../tags">Tags</a></li></ul></nav><hr></header><section><content><article><h1><a href="">함수 포인터를 써보자</a></h1><nav style="display:flex; height: 100%"><p>2022/01/14 16:42:19 Fri</p><a class="tag" href="../../../tags/c">c</a></nav><br><p></p><h2>함수 포인터란</h2>
<h3>선언</h3>
<ul>
<li><code>반환값 (*이름)(인자 목록)</code></li>
<li>포인터가 값의 주소를 담듯 함수의 주소를 담음</li>
</ul>
<pre><code class="language-c hljs"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">sayhello</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello World\n"</span>);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  <span class="hljs-type">int</span> value = <span class="hljs-number">3</span>;
  <span class="hljs-type">int</span> *ptr = &amp;value;
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"포인터가 가리키는 값은 %d\n"</span>, *ptr);

  <span class="hljs-type">void</span> (*fp1)() = &amp;sayhello;
  (*fp1)();
  <span class="hljs-type">int</span> (*fp2)(<span class="hljs-type">int</span>) = &amp;saynum;
  (*fp2)(<span class="hljs-number">10</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
포인터가 가리키는 값은 <span class="hljs-number">3</span>
Hello World
입력값: <span class="hljs-number">10</span>
</code></pre>
<p>일반 포인터를 쓰는 것과 비슷하게</p>
<ul>
<li>참조할 함수의 주소를 대입하고</li>
<li>별(*) 기호로 역참조해 쓴다.</li>
</ul>
<h3>간략하게 사용</h3>
<pre><code class="language-c hljs"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  <span class="hljs-type">void</span> (*fp3)() = sayhello;
  fp3();
  <span class="hljs-type">int</span> (*fp4)(<span class="hljs-type">int</span>) = saynum;
  fp4(<span class="hljs-number">10</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
Hello World
입력값: <span class="hljs-number">10</span>
</code></pre>
<p>그런데 함수의 이름은 고유하니</p>
<ul>
<li>&amp; 기호를 넣을 필요없이 이름만 쓰고</li>
</ul>
<p>괄호를 이용해 함수와 같이 쓰는 건 똑같으므로</p>
<ul>
<li>역참조와 괄호도 생략해도 된다.</li>
</ul>
<pre><code class="language-c hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">void</span> <span class="hljs-params">(*myfunc)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;

<span class="hljs-type">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">(myfunc f, <span class="hljs-type">int</span> num)</span> {
  f(num);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  myfunc func = saynum;
  func(<span class="hljs-number">5</span>);
  example(saynum, <span class="hljs-number">123</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
입력값: <span class="hljs-number">5</span>
입력값: <span class="hljs-number">123</span>
</code></pre>
<p>typedef를 이용해 자료형을 지정하면 쓰기 더 편하다.</p>
<h2>함수 포인터 써보기</h2>
<h3>조건문을 쓰는 방식(기존)</h3>
<pre><code class="language-c hljs">
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">calc</span><span class="hljs-params">(<span class="hljs-type">int</span> which, <span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-type">int</span> res;
  <span class="hljs-keyword">switch</span> (which) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
      res = a + b;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
      res = a - b;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
      res = a * b;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
      res = a / b;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> res;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  <span class="hljs-type">int</span> a = <span class="hljs-number">12</span>, b = <span class="hljs-number">5</span>;

  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"a: %d, b: %d\n"</span>, a, b);
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"덧셈 결과: %d\n"</span>, calc(<span class="hljs-number">0</span>, a, b));
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"뺄셈 결과: %d\n"</span>, calc(<span class="hljs-number">1</span>, a, b));
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"곱셈 결과: %d\n"</span>, calc(<span class="hljs-number">2</span>, a, b));
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"나눗셈 결과: %d\n"</span>, calc(<span class="hljs-number">3</span>, a, b));
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
a: <span class="hljs-number">12</span>, b: <span class="hljs-number">5</span>
덧셈 결과: <span class="hljs-number">17</span>
뺄셈 결과: <span class="hljs-number">7</span>
곱셈 결과: <span class="hljs-number">60</span>
나눗셈 결과: <span class="hljs-number">2</span>
</code></pre>
<ul>
<li><code>#define</code></li>
<li><code>enum</code></li>
</ul>
<p>을 쓴다면 좀 더 읽기 편하겠지만 거듭제곱, 나머지... 10가지 기능을 더 추가해야 한다면? <code>switch</code>문이 계속 길어지게 된다.</p>
<h3>함수 포인터를 이용한 방식</h3>
<pre><code class="language-c hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">int</span> <span class="hljs-params">(*calcfunc)</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>;

<span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-type">int</span> <span class="hljs-title function_">sub</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-type">int</span> <span class="hljs-title function_">mul</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-keyword">return</span> a * b;
}
<span class="hljs-type">int</span> <span class="hljs-title function_">div</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">calc</span><span class="hljs-params">(calcfunc func, <span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
  <span class="hljs-keyword">return</span> func(a, b);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
  <span class="hljs-type">int</span> a = <span class="hljs-number">12</span>, b = <span class="hljs-number">5</span>;
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"a: %d, b: %d\n"</span>, a, b);

  <span class="hljs-type">char</span>* which[] = {<span class="hljs-string">"덧셈"</span>, <span class="hljs-string">"뺄셈"</span>, <span class="hljs-string">"곱셈"</span>, <span class="hljs-string">"나눗셈"</span>};
  calcfunc func[] = {add, sub, mul, div};
  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s 결과: %d\n"</span>, which[i], calc(func[i], a, b));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
a: <span class="hljs-number">12</span>, b: <span class="hljs-number">5</span>
덧셈 결과: <span class="hljs-number">17</span>
뺄셈 결과: <span class="hljs-number">7</span>
곱셈 결과: <span class="hljs-number">60</span>
나눗셈 결과: <span class="hljs-number">2</span>
</code></pre>
<p>이제 <code>calc</code> 함수를 변경할 필요 없이 다양한 함수를 입력값으로 넣어 유연하게 사용할 수 있다.</p>
<p></p></article><hr><script src="https://utteranc.es/client.js" repo="scarf005/comments" issue-term="pathname" label="comment" theme="github-dark" crossorigin="anonymous" async=""></script></content></section><footer></footer><link rel="stylesheet" href="../../../fonts.css" type="text/css"></body></html>